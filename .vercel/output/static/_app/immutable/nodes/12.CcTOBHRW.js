import{n as Be,a as oe,t as $e}from"../chunks/DrjBu-Pq.js";import"../chunks/CeIxqNZp.js";import{r as Tt,t as hi,w as ve,a3 as ci,d as di,a5 as ui,j as z,as as Si,a1 as Z,a6 as ke,a2 as U,a4 as re,f as _i,s as ne}from"../chunks/CnMiI8Eq.js";import{l as fi,r as Me,d as gi,c as it,e as Ci,f as ki,A as kt,b as rt,p as ot,s as $t}from"../chunks/DBFkeIrc.js";import{P as Ti}from"../chunks/DE6164g9.js";import{i as xt}from"../chunks/C5Eoiutq.js";import{e as Bi,i as Mi}from"../chunks/BawPrrbX.js";import{s as Ie,d as vi,c as Ii,a as Ve,b as Ht,r as Gt,f as Oi}from"../chunks/D6dCMEXs.js";import{t as Fi,a as Ni}from"../chunks/Du2eR-a3.js";import{b as dt}from"../chunks/DokX3KHN.js";import{w as Bt,o as pi}from"../chunks/NnwbaNEq.js";import{S as Pt}from"../chunks/Ch0D9eUt.js";import{G as Di}from"../chunks/ChxX1nUb.js";function $i(r,e,t=e){var i,a,h=()=>{cancelAnimationFrame(i),r.paused||(i=requestAnimationFrame(h));var n=r.currentTime;a!==n&&t(a=n)};i=requestAnimationFrame(h),r.addEventListener("timeupdate",h),Tt(()=>{var n=Number(e());a!==n&&!isNaN(n)&&(r.currentTime=a=n)}),hi(()=>{cancelAnimationFrame(i),r.removeEventListener("timeupdate",h)})}function Hi(r,e,t=e){var i=()=>{t(r.volume)};e()==null&&i(),fi(r,["volumechange"],i,!1),Tt(()=>{var a=Number(e());a!==r.volume&&!isNaN(a)&&(r.volume=a)})}function Gi(r,e,t=e){var i=()=>{t(r.muted)};e()==null&&i(),fi(r,["volumechange"],i,!1),Tt(()=>{var a=!!e();r.muted!==a&&(r.muted=a)})}function Pi(r,e,t,i,a){var h=()=>{i(t[r])};t.addEventListener(e,h),h(),(t===document.body||t===window||t===document)&&hi(()=>{t.removeEventListener(e,h)})}var zi=Be('<svg><path fill="currentColor" d="M240 136v64a16 16 0 0 1-16 16H32a16 16 0 0 1-16-16v-64a16 16 0 0 1 16-16h40a8 8 0 0 1 0 16H32v64h192v-64h-40a8 8 0 0 1 0-16h40a16 16 0 0 1 16 16m-117.66-2.34a8 8 0 0 0 11.32 0l48-48a8 8 0 0 0-11.32-11.32L136 108.69V24a8 8 0 0 0-16 0v84.69L85.66 74.34a8 8 0 0 0-11.32 11.32ZM200 168a12 12 0 1 0-12 12a12 12 0 0 0 12-12"></path></svg>');function qi(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=zi();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var Xi=Be('<svg><path fill="currentColor" d="M99.06 128.61a8 8 0 0 0-8.72 1.73L68.69 152H48a8 8 0 0 0-8 8v40a8 8 0 0 0 8 8h20.69l21.65 21.66A8 8 0 0 0 104 224v-88a8 8 0 0 0-4.94-7.39M88 204.69l-10.34-10.35A8 8 0 0 0 72 192H56v-24h16a8 8 0 0 0 5.66-2.34L88 155.31ZM152 180a40.55 40.55 0 0 1-20 34.91a8 8 0 0 1-8-13.82a24.49 24.49 0 0 0 0-42.18a8 8 0 0 1 8-13.82A40.55 40.55 0 0 1 152 180m61.66-97.66l-56-56A8 8 0 0 0 152 24H56a16 16 0 0 0-16 16v80a8 8 0 0 0 16 0V40h88v48a8 8 0 0 0 8 8h48v120h-32a8 8 0 0 0 0 16h32a16 16 0 0 0 16-16V88a8 8 0 0 0-2.34-5.66M160 51.31L188.69 80H160Z"></path></svg>');function Vi(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=Xi();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var Wi=Be('<svg><path fill="currentColor" d="M212.92 17.69a8 8 0 0 0-6.86-1.45l-128 32A8 8 0 0 0 72 56v110.08A36 36 0 1 0 88 196v-85.75l112-28v51.83A36 36 0 1 0 216 164V24a8 8 0 0 0-3.08-6.31M52 216a20 20 0 1 1 20-20a20 20 0 0 1-20 20M88 93.75v-31.5l112-28v31.5ZM180 184a20 20 0 1 1 20-20a20 20 0 0 1-20 20"></path></svg>');function Ui(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=Wi();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var Yi=Be('<svg><path fill="currentColor" d="M216 48v160a16 16 0 0 1-16 16h-40a16 16 0 0 1-16-16V48a16 16 0 0 1 16-16h40a16 16 0 0 1 16 16M96 32H56a16 16 0 0 0-16 16v160a16 16 0 0 0 16 16h40a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16"></path></svg>');function Zi(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=Yi();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var ji=Be('<svg><path fill="currentColor" d="M240 128a15.74 15.74 0 0 1-7.6 13.51L88.32 229.65a16 16 0 0 1-16.2.3A15.86 15.86 0 0 1 64 216.13V39.87a15.86 15.86 0 0 1 8.12-13.82a16 16 0 0 1 16.2.3l144.08 88.14A15.74 15.74 0 0 1 240 128"></path></svg>');function Qi(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=ji();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var Ki=Be('<svg><path fill="currentColor" d="M199.81 34a16 16 0 0 0-16.24.43L64 109.23V40a8 8 0 0 0-16 0v176a8 8 0 0 0 16 0v-69.23l119.57 74.78A15.95 15.95 0 0 0 208 208.12V47.88A15.86 15.86 0 0 0 199.81 34M192 208L64.16 128L192 48.07Z"></path></svg>');function Ji(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=Ki();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var es=Be('<svg><path fill="currentColor" d="M200 32a8 8 0 0 0-8 8v69.23L72.43 34.45A15.95 15.95 0 0 0 48 47.88v160.24a16 16 0 0 0 24.43 13.43L192 146.77V216a8 8 0 0 0 16 0V40a8 8 0 0 0-8-8M64 207.93V48.05l127.84 80Z"></path></svg>');function ts(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=es();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var is=Be('<svg><path fill="currentColor" d="M155.51 24.81a8 8 0 0 0-8.42.88L77.25 80H32a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h45.25l69.84 54.31A8 8 0 0 0 160 224V32a8 8 0 0 0-4.49-7.19M32 96h40v64H32Zm112 111.64l-56-43.55V91.91l56-43.55Zm54-106.08a40 40 0 0 1 0 52.88a8 8 0 0 1-12-10.58a24 24 0 0 0 0-31.72a8 8 0 0 1 12-10.58M248 128a79.9 79.9 0 0 1-20.37 53.34a8 8 0 0 1-11.92-10.67a64 64 0 0 0 0-85.33a8 8 0 1 1 11.92-10.67A79.83 79.83 0 0 1 248 128"></path></svg>');function ss(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=is();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}var as=Be('<svg><path fill="currentColor" d="M155.51 24.81a8 8 0 0 0-8.42.88L77.25 80H32a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h45.25l69.84 54.31A8 8 0 0 0 160 224V32a8 8 0 0 0-4.49-7.19M32 96h40v64H32Zm112 111.64l-56-43.55V91.91l56-43.55Zm101.66-61.3a8 8 0 0 1-11.32 11.32L216 139.31l-18.34 18.35a8 8 0 0 1-11.32-11.32L204.69 128l-18.35-18.34a8 8 0 0 1 11.32-11.32L216 116.69l18.34-18.35a8 8 0 0 1 11.32 11.32L227.31 128Z"></path></svg>');function ns(r,e){const t=Me(e,["$$slots","$$events","$$legacy"]);var i=as();let a;ve(()=>a=Ie(i,a,{class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t})),oe(r,i)}/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.5.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const rs="4.5.0",Mt=Math.PI,Ye=2*Mt,At=Mt/2,zt=8.17579892,qt="dual-combined",lt="dual-horizontal",Te="single",Se="dual-vertical",Xt="bar-index",Vt="bar-level",ut="gradient",Wt=60,Ut="click",os="fullscreenchange",mi="resize",ls="#111",yi="",Yt="A",Zt="B",jt="C",Qt="D",Kt="468",ht="sans-serif",hs="#0f0",cs="#7f7f7f22",Ze=10,Jt="create",ei="fschange",ds="lores",us=mi,Rt="user",_s="#000c",ti="#fff",fs="#4f4",ii="#888",gs="#555",Et="bark",et="linear",je="log",St="mel",si=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],wi=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:si}],["rainbow",{dir:"h",colorStops:["#817",...si,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],tt={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:Te,colorMode:ut,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:je,gradient:wi[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:yi,width:void 0},vs=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],ps=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],ms=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],Ct=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],ys=["ERR_INVALID_MODE","Invalid mode"],ws=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],bs=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],Ls=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],xs=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],As=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class Le extends Error{constructor(e,t){const[i,a]=e;super(a+(t!==void 0?`: ${t}`:"")),this.name="AudioMotionError",this.code=i}}const ai=(r,e)=>console.warn(`${r} is deprecated. Use ${e} instead.`),ni=r=>{for(const e in r)return!1;return!0},ct=(r,e,t="toLowerCase")=>e[Math.max(0,e.indexOf((""+r)[t]()))],Rs=(r,e,t,i,a)=>e+(i-e)*(a-r)/(t-r);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(r){let e=this.length;for(;e-- >0;)if(r(this[e]))return e;return-1});class Es{constructor(e,t={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],e instanceof Element||(ni(t)&&!ni(e)&&(t=e),e=null),this._ownCanvas=!(t.canvas instanceof HTMLCanvasElement);const i=this._ownCanvas?document.createElement("canvas"):t.canvas;i.style="max-width: 100%;",this._ctx=i.getContext("2d");for(const[v,p]of wi)this.registerGradient(v,p);this._container=e||!this._ownCanvas&&i.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let a;if(!(t.source&&(a=t.source.context))){if(!(a=t.audioCtx))try{a=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new Le(vs)}}if(!a.createGain)throw new Le(ps);const h=this._analyzer=[a.createAnalyser(),a.createAnalyser()],n=this._splitter=a.createChannelSplitter(2),o=this._merger=a.createChannelMerger(2);this._input=a.createGain(),this._output=a.createGain(),t.source&&this.connectInput(t.source);for(const v of[0,1])n.connect(h[v],v);o.connect(this._output),t.connectSpeakers!==!1&&this.connectOutput();for(const v of["_scaleX","_scaleR"])this[v]=document.createElement("canvas").getContext("2d");this._fsEl=t.fsElement||i;const c=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(us),this._fsTimeout=0)},Wt))};window.ResizeObserver&&(this._observer=new ResizeObserver(c),this._observer.observe(this._container)),this._controller=new AbortController;const y=this._controller.signal;window.addEventListener(mi,c,{signal:y}),i.addEventListener(os,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(ei),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},Wt)},{signal:y});const g=()=>{a.state=="suspended"&&a.resume(),window.removeEventListener(Ut,g)};window.addEventListener(Ut,g),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:y}),this._setProps(t,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(i),this._ready=!0,this._setCanvas(Jt)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=ct(e,[Te,lt,Se,qt]),this._input.disconnect(),this._input.connect(this._chLayout!=Te?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=Te?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=ct(e,[ut,Xt,Vt])}get fadePeaks(){return this._fadePeaks}set fadePeaks(e){this._fadePeaks=!!e}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const i of[0,1])this._analyzer[i].fftSize=e;const t=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(t),new Float32Array(t)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=ct(e,[je,Et,St,et]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get gravity(){return this._gravity}set gravity(e){this._gravity=e>0?+e:this._gravity||tt.gravity}get height(){return this._height}set height(e){this._height=e,this._setCanvas(Rt)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(ds)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const t of[0,1])this._analyzer[t].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new Le(Ct);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const t of[0,1])this._analyzer[t].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new Le(Ct);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const t=e|0;if(t>=0&&t<=10&&t!=9)this._mode=t,this._calcBars(),this._makeGrad();else throw new Le(ys,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(e){this._peakFadeTime=e>=0?+e:this._peakFadeTime||tt.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(e){this._peakHoldTime=+e||0}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(e){this._radialInvert=!!e,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(e){this._radius=+e||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new Le(ws);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const t of[0,1])this._analyzer[t].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-At),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return ai("stereo","channelLayout"),this._chLayout!=Te}set stereo(e){ai("stereo","channelLayout"),this.channelLayout=e?Se:Te}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=ct(e,[yi,Yt,Zt,jt,Qt,Kt],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(Rt)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return rs}connectInput(e){const t=e instanceof HTMLMediaElement;if(!(t||e.connect))throw new Le(bs);const i=t?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(i)||(i.connect(this._input),this._sources.push(i)),i}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const t of[0,1])this._analyzer[t].connect(this._chLayout==Te&&!t?this._output:this._merger,0,t)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:t,_controller:i,_input:a,_merger:h,_observer:n,_ownCanvas:o,_ownContext:c,_splitter:y}=this;this._destroyed=!0,this._ready=!1,this.stop(),i.abort(),n&&n.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),a.disconnect(),y.disconnect(),h.disconnect(),c&&e.close(),o&&t.remove(),this._calcBars()}disconnectInput(e,t){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const i of e){const a=this._sources.indexOf(i);if(t&&i.mediaStream)for(const h of i.mediaStream.getAudioTracks())h.stop();a>=0&&(i.disconnect(this._input),this._sources.splice(a,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(t=>t!==e):[],this._outNodes.length==0))for(const t of[0,1])this._analyzer[t].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:t,freqLo:i,freqHi:a,hold:h,peak:n,value:o})=>({posX:e,freq:t,freqLo:i,freqHi:a,hold:h,peak:n,value:o}))}getEnergy(e,t){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const o={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!o[e])return null;[e,t]=o[e]}const i=this._freqToBin(e),a=t?this._freqToBin(t):i,h=this._chLayout==Te?1:2;let n=0;for(let o=0;o<h;o++)for(let c=i;c<=a;c++)n+=this._normalizedB(this._fftData[o][c]);return n/(a-i+1)/h}getOptions(e){Array.isArray(e)||(e=[e]);let t={};for(const i of Object.keys(tt))e.includes(i)||(i=="gradient"&&this.gradientLeft!=this.gradientRight?(t.gradientLeft=this.gradientLeft,t.gradientRight=this.gradientRight):i!="start"&&(t[i]=this[i]));return t}registerGradient(e,t){if(typeof e!="string"||e.trim().length==0)throw new Le(Ls);if(typeof t!="object")throw new Le(xs);const{colorStops:i}=t;if(!Array.isArray(i)||!i.length)throw new Le(As);const a=i.length,h=n=>+n!=n||n<0||n>1;i.forEach((n,o)=>{const c=o/Math.max(1,a-1);typeof n!="object"?i[o]={pos:c,color:n}:h(n.pos)&&(n.pos=c),h(n.level)&&(i[o].level=1-o/a)}),i.sort((n,o)=>n.level<o.level?1:n.level>o.level?-1:0),i[0].level=1,this._gradients[e]={bgColor:t.bgColor||ls,dir:t.dir,colorStops:i},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,t){this._width=e,this._height=t,this._setCanvas(Rt)}setFreqRange(e,t){if(e<1||t<1)throw new Le(Ct);this._minFreq=Math.min(e,t),this.maxFreq=Math.max(e,t)}setLedParams(e){let t,i,a;e&&(t=e.maxLeds|0,i=+e.spaceV,a=+e.spaceH),this._ledParams=t>0&&i>0&&a>=0?[t,i,a]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,t){for(const i of[0,1])this._analyzer[i].minDecibels=Math.min(e,t),this._analyzer[i].maxDecibels=Math.max(e,t)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const t=this.isOn;return e===void 0&&(e=!t),t&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!t&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(i=>this._draw(i))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:t,_barSpace:i,canvas:a,_chLayout:h,_maxFreq:n,_minFreq:o,_mirror:c,_mode:y,_radial:g,_radialInvert:v,_reflexRatio:p}=this,k=a.width>>1,V=a.height>>1,N=h==Se&&!g,j=h==lt,H=y%10!=0,le=H&&this._frequencyScale==je,R=this._showLeds&&H&&!g,B=this._lumiBars&&H&&!g,_e=this._alphaBars&&!B&&y!=Ze,ee=this._outlineBars&&H&&!B&&!R,b=this._roundBars&&H&&!B&&!R,te=h!=Se||p>0&&!B,X=a.height-(N&&!R?.5:0)>>N,Q=X*(B||g?1:1-p)|0,s=a.width-k*(j||c!=0),ie=N?a.height-X*2:0,he=k*(c==-1&&!j&&!g);let de=Math.min(a.width,a.height)*.375*(h==Se?1:this._radius)|0,D=Math.min(k,V);v&&h!=Se&&([de,D]=[D,de]);const F=I=>e.push({...I,peak:[0,0],hold:[0],alpha:[0],value:[0]}),E=I=>{const M=this._freqToBin(I,"floor"),L=this._binToFreq(M),C=this._binToFreq(M+1),G=Math.log2(I/L)/Math.log2(C/L);return[M,G]};let m,W,O;if(le){const I=(u,x,A)=>+u.toPrecision(A?Math.max(x,1+Math.log10(u)|0):x),M=u=>{const x=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],A=Math.log10(u)|0,fe=u/10**A;let me=1;for(;me<x.length&&fe>x[me];)me++;return fe-x[me-1]<x[me]-fe&&me--,(x[me]*10**(A+5)|0)/1e5},L=[0,24,12,8,6,4,3,2,1][y],C=t?10**(3/(L*10)):2**(1/L),G=C**.5;let K=t?7.94328235/(L%2?1:G):zt;do{let u=K;const x=I(u/G,4,!0),A=I(u*G,4,!0),[fe,me]=E(x),[Ae,we]=E(A);t?u=L<4?M(u):I(u,u.toString()[0]<5?3:2):u=I(u,4,!0),u>=o&&F({posX:0,freq:u,freqLo:x,freqHi:A,binLo:fe,binHi:Ae,ratioLo:me,ratioHi:we}),K*=C}while(K<=n);m=s/e.length,e.forEach((u,x)=>u.posX=he+x*m);const $=e[0],d=e[e.length-1];W=this._freqScaling($.freqLo),O=s/(this._freqScaling(d.freqHi)-W),$.freqLo<o&&($.freqLo=o,[$.binLo,$.ratioLo]=E(o)),d.freqHi>n&&(d.freqHi=n,[d.binHi,d.ratioHi]=E(n))}else if(H){const I=[0,24,12,8,6,4,3,2,1][y]*10,M=L=>{switch(this._frequencyScale){case Et:return 1960/(26.81/(L+.53)-1);case St:return 700*(2**L-1);case et:return L}};m=s/I,W=this._freqScaling(o),O=s/(this._freqScaling(n)-W);for(let L=0,C=0;L<I;L++,C+=m){const G=M(W+C/O),K=M(W+(C+m/2)/O),$=M(W+(C+m)/O),[d,u]=E(G),[x,A]=E($);F({posX:he+C,freq:K,freqLo:G,freqHi:$,binLo:d,binHi:x,ratioLo:u,ratioHi:A})}}else{m=1,W=this._freqScaling(o),O=s/(this._freqScaling(n)-W);const I=this._freqToBin(o,"floor"),M=this._freqToBin(n);let L=-999;for(let C=I;C<=M;C++){const G=this._binToFreq(C),K=he+Math.round(O*(this._freqScaling(G)-W));if(K>L)F({posX:K,freq:G,freqLo:G,freqHi:G,binLo:C,binHi:C,ratioLo:0,ratioHi:0}),L=K;else if(e.length){const $=e[e.length-1];$.binHi=C,$.freqHi=G,$.freq=($.freqLo*G)**.5}}}let ce=0,Y=0;if(R){const I=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),M=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],L=this._ledParams,[C,G,K]=L||M[y];let $,d=Q;if(L){const u=2*I;let x;$=C+1;do $--,x=d/$/(1+G),Y=x*G;while((x<u||Y<u)&&$>1)}else{const u=540/G;Y=Math.min(G*I,Math.max(2,d/u+.1|0))}te&&(d+=Y),L||($=Math.min(C,d/(Y*2)|0)),ce=K>=1?K:m*K,this._leds=[$,ce,Y,d/$-Y]}const S=Math.min(m-1,i*(i>0&&i<1?m:1));H&&(m-=Math.max(R?ce:0,S)),e.forEach((I,M)=>{let L=I.posX,C=m;H&&(i==0&&!R?(L|=0,C|=0,M>0&&L>e[M-1].posX+e[M-1].width&&(L--,C++)):L+=Math.max(R?ce:0,S)/2,I.posX=L),I.barCenter=L+(m==1?0:C/2),I.width=C});const pe=[];for(const I of[0,1]){const M=h==Se?(X+ie)*I:0,L=M+X,C=M+Q-(!R||te?0:Y);pe.push({channelTop:M,channelBottom:L,analyzerBottom:C})}this._aux={analyzerHeight:Q,analyzerWidth:s,centerX:k,centerY:V,channelCoords:pe,channelHeight:X,channelGap:ie,initialX:he,innerRadius:de,outerRadius:D,scaleMin:W,unitWidth:O},this._flg={isAlpha:_e,isBands:H,isLeds:R,isLumi:B,isOctaves:le,isOutline:ee,isRound:b,noLedGap:te},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:t,innerRadius:i,scaleMin:a,unitWidth:h}=this._aux,{canvas:n,_frequencyScale:o,_mirror:c,_noteLabels:y,_radial:g,_scaleX:v,_scaleR:p}=this,k=v.canvas,V=p.canvas,N=[],j=this._chLayout==lt,H=this._chLayout==Se,le=Math.min(n.width,n.height),R=["C",,"D",,"E","F",,"G",,"A",,"B"],B=le/34|0,_e=k.height>>1,ee=B>>1,b=_e*(y?.7:1.5),te=ee*(y?1:2),X=2**(1/12);if(!y&&(this._ansiBands||o!=je))N.push(16,31.5,63,125,250,500,1e3,2e3,4e3),o==et?N.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):N.push(8e3,16e3);else{let D=zt;for(let F=-1;F<11;F++)for(let E=0;E<12;E++){if(D>=this._minFreq&&D<=this._maxFreq){const m=R[E],W=m=="C";(m&&y&&!c&&!j||W)&&N.push(y?[D,m+(W?F:"")]:D)}D*=X}}V.width=V.height=Math.max(le*.15,(i<<1)+H*B);const Q=V.width>>1,s=Q-B*.7,ie=(D,F)=>{const E=Ye*(D/n.width),m=E-At,W=s*Math.cos(m),O=s*Math.sin(m);p.save(),p.translate(Q+W,Q+O),p.rotate(E),p.fillText(F,0,0),p.restore()};k.width|=0,v.fillStyle=p.strokeStyle=_s,v.fillRect(0,0,k.width,k.height),p.arc(Q,Q,Q-B/2,0,Ye),p.lineWidth=B,p.stroke(),v.fillStyle=p.fillStyle=ti,v.font=`${_e}px ${ht}`,p.font=`${ee}px ${ht}`,v.textAlign=p.textAlign="center";let he=-b/4,de=-te;for(const D of N){const[F,E]=Array.isArray(D)?D:[D,D<1e3?D|0:`${(D/100|0)/10}k`],m=h*(this._freqScaling(F)-a),W=k.height*.75,O=E[0]=="C",ce=_e*(y&&!c&&!j?O?1.2:.6:3);if(v.fillStyle=p.fillStyle=O&&!c&&!j?fs:ti,y){const Y=o==je,S=o==et;let pe=["C"];if((Y||F>2e3||!S&&F>250||(!g||H)&&(!S&&F>125||F>1e3))&&pe.push("G"),(Y||F>4e3||!S&&F>500||(!g||H)&&(!S&&F>250||F>2e3))&&pe.push("E"),(S&&F>4e3||(!g||H)&&(Y||F>2e3||!S&&F>500))&&pe.push("D","F","A","B"),!pe.includes(E[0]))continue}m>=he+b/2&&m<=e&&(v.fillText(E,j&&c==-1?e-m:t+m,W,ce),(j||c&&(m>b||c==1))&&v.fillText(E,j&&c!=1?e+m:(t||n.width)-m,W,ce),he=m+Math.min(ce,v.measureText(E).width)/2),m>=de+te&&m<e-te&&(ie(j&&c==1?e-m:m,E),(j||c&&(m>te||c==1))&&ie(j&&c!=-1?e+m:-m,E),de=m)}}_draw(e){this._runId=requestAnimationFrame(l=>this._draw(l));const t=e-this._time,i=e-this._last,a=this._maxFPS?975/this._maxFPS:0;if(i<a)return;this._last=e-(a?i%a:0),this._frames++,t>=1e3&&(this._fps=this._frames/t*1e3,this._frames=0,this._time=e);const{isAlpha:h,isBands:n,isLeds:o,isLumi:c,isOctaves:y,isOutline:g,isRound:v,noLedGap:p}=this._flg,{analyzerHeight:k,centerX:V,centerY:N,channelCoords:j,channelHeight:H,channelGap:le,initialX:R,innerRadius:B,outerRadius:_e}=this._aux,{_bars:ee,canvas:b,_canvasGradients:te,_chLayout:X,_colorMode:Q,_ctx:s,_energy:ie,_fadePeaks:he,fillAlpha:de,_fps:D,_linearAmplitude:F,_lineWidth:E,maxDecibels:m,minDecibels:W,_mirror:O,_mode:ce,overlay:Y,_radial:S,showBgColor:pe,showPeaks:I,useCanvas:M,_weightingFilter:L}=this,C=this._scaleX.canvas,G=this._scaleR.canvas,K=D*this._peakFadeTime/1e3,$=D**2,d=this._gravity*1e3,u=D*this._peakHoldTime/1e3,x=X==qt,A=X==lt,fe=X==Se,me=X==Te,Ae=o&&this._trueLeds&&Q==ut,we=S?b.width:this._aux.analyzerWidth,gt=R+we,Qe=I&&this._peakLine&&ce==Ze,Oe=S?_e-B:k,bi=Oe/this._pixelRatio,[Li,zs,Ke,vt]=this._leds||[];ie.val>0&&D>0&&(this._spinAngle+=this._spinSpeed*Ye/60/D);const xi=l=>{if(this._reflexRatio>0&&!c&&!S){let T,Re;this.reflexFit||fe?(T=fe&&l==0?H+le:0,Re=H-k):(T=b.height-k*2,Re=k),s.save(),s.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(s.filter=`brightness(${this.reflexBright})`),s.setTransform(1,0,0,-1,0,b.height),s.drawImage(b,0,j[l].channelTop,b.width,k,0,T,b.width,Re),s.restore()}},Ai=()=>{this.showScaleX&&(S?(s.save(),s.translate(V,N),this._spinSpeed&&s.rotate(this._spinAngle+At),s.drawImage(G,-G.width>>1,-G.width>>1),s.restore()):s.drawImage(C,0,b.height-C.height))},Ri=l=>{const T=l**2,Re=424.36,ae=11599.29,st=25122.25,Fe=544496.41,Ce=148693636,Ge=Pe=>20*Math.log10(Pe);switch(L){case Yt:const Pe=Ce*T**2/((T+Re)*Math.sqrt((T+ae)*(T+Fe))*(T+Ce));return 2+Ge(Pe);case Zt:const ze=Ce*T*l/((T+Re)*Math.sqrt(T+st)*(T+Ce));return .17+Ge(ze);case jt:const yt=Ce*T/((T+Re)*(T+Ce));return .06+Ge(yt);case Qt:const at=((103791848e-2-T)**2+108076816e-2*T)/((9837328-T)**2+11723776*T),wt=l/68966888496476e-18*Math.sqrt(at/((T+79919.29)*(T+1345600)));return Ge(wt);case Kt:const nt=-4737338981378384e-39*l**6+2043828333606125e-30*l**4-1363894795463638e-22*T+1,qe=1306612257412824e-34*l**5-2118150887518656e-26*l**3+.0005559488023498642*l,ye=.0001246332637532143*l/Math.hypot(nt,qe);return 18.2+Ge(ye)}return 0},pt=(l,T,Re)=>{s.beginPath(),s.moveTo(l,T),s.lineTo(l,Re),s.stroke()},mt=l=>{if(l&&E){const T=s.globalAlpha;s.globalAlpha=1,s.stroke(),s.globalAlpha=T}},He=l=>Math.max(0,(l*Li|0)*(vt+Ke)-Ke),Ei=l=>{ie.val=l,ie.peak>0&&(ie.hold--,ie.hold<0&&(ie.peak+=ie.hold*d/$/b.height*this._pixelRatio)),l>=ie.peak&&(ie.peak=l,ie.hold=u)};Y&&s.clearRect(0,0,b.width,b.height);let It=0;const Ot=ee.length,Ft=me?1:2;for(let l=0;l<Ft;l++){const{channelTop:T,channelBottom:Re,analyzerBottom:ae}=j[l],st=this._gradients[this._selectedGrads[l]],Fe=st.colorStops,Ce=Fe.length,Ge=!pe||o&&!Y?"#000":st.bgColor,Pe=fe&&S&&l?-1:1,ze=!l&&O==-1||l&&O==1,yt=!A||l&&O!=1?0:we>>(l||!ze),at=A&&ze?-1:1,wt=()=>{const _=C.height,f=_>>1,w=F?100:m,q=F?0:W,J=F?20:5,ge=k/(w-q),Ee=O!=-1&&(!A||l==0||O==1),Ne=O!=1&&(!A||l!=O);s.save(),s.fillStyle=ii,s.font=`${f}px ${ht}`,s.textAlign="right",s.lineWidth=1;for(let De=w;De>q;De-=J){const We=T+(w-De)*ge,se=De%2==0|0;if(se){const ue=We+f*(We==T?.8:.35);Ee&&s.fillText(De,_*.85,ue),Ne&&s.fillText(De,(A?we:b.width)-_*.1,ue),s.strokeStyle=ii,s.setLineDash([2,4]),s.lineDashOffset=0}else s.strokeStyle=gs,s.setLineDash([2,8]),s.lineDashOffset=1;s.beginPath(),s.moveTo(R+_*se*Ee,~~We+.5),s.lineTo(gt-_*se*Ne,~~We+.5),s.stroke()}s.restore()},nt=(_,f)=>{const w=xe[_]+(_<xe.length-1?(xe[_+1]-xe[_])*f:0);return isNaN(w)?-1/0:w},qe=(_,f=at)=>f*Ye*((_+yt)/b.width)+this._spinAngle,ye=(_,f,w)=>{const q=B+f*Pe,J=qe(_,w);return[V+q*Math.cos(J),N+q*Math.sin(J)]},bt=(_,f,w,q,J)=>{s.beginPath();for(const ge of O&&!A?[1,-1]:[at]){const[Ee,Ne]=v?[qe(_,ge),qe(_+w,ge)]:[];s.moveTo(...ye(_,f,ge)),s.lineTo(...ye(_,f+q,ge)),v?s.arc(V,N,B+(f+q)*Pe,Ee,Ne,ge!=1):s.lineTo(...ye(_+w,f+q,ge)),s.lineTo(...ye(_+w,f,ge)),v&&!J&&s.arc(V,N,B+f*Pe,Ne,Ee,ge==1)}mt(J),s.fill()},Lt=(_=0,f=0)=>{let w;if(Q==ut&&!Ae||ce==Ze)w=te[l];else{const q=Q==Xt?f%Ce:Fe.findLastIndex(J=>o?He(_)<=He(J.level):_<=J.level);w=Fe[q].color}s.fillStyle=s.strokeStyle=w};if(M){if(A&&!S){const _=we*(l+ze),f=ze?-1:1;s.setTransform(f,0,0,1,_,0)}if((!Y||pe)&&(Y&&(s.globalAlpha=this.bgAlpha),s.fillStyle=Ge,(l==0||!S&&!x)&&s.fillRect(R,T-le,we,(Y&&this.reflexAlpha==1?k:H)+le),s.globalAlpha=1),this.showScaleY&&!c&&!S&&(l==0||!x)&&wt(),o?(s.setLineDash([vt,Ke]),s.lineWidth=ee[0].width):s.lineWidth=g?Math.min(E,ee[0].width/2):E,s.save(),!S){const _=new Path2D;_.rect(0,T,b.width,k),s.clip(_)}}let xe=this._fftData[l];this._analyzer[l].getFloatFrequencyData(xe),L&&(xe=xe.map((_,f)=>_+Ri(this._binToFreq(f)))),s.beginPath();let Je=[];for(let _=0;_<Ot;_++){const f=ee[_],{posX:w,barCenter:q,width:J,freq:ge,binLo:Ee,binHi:Ne,ratioLo:De,ratioHi:We}=f;let se=Math.max(nt(Ee,De),nt(Ne,We));for(let P=Ee+1;P<Ne;P++)xe[P]>se&&(se=xe[P]);if(se=this._normalizedB(se),f.value[l]=se,It+=se,f.peak[l]>0&&f.alpha[l]>0&&(f.hold[l]--,f.hold[l]<0)){if(he&&!Qe){const P=!h||g&&E>0?1:h?f.peak[l]:de;f.alpha[l]=P*(1+f.hold[l]/K)}else f.peak[l]+=f.hold[l]*d/$/bi;f.alpha[l]<=0&&(f.peak[l]=0)}if(se>=f.peak[l]&&(f.peak[l]=se,f.hold[l]=u,f.alpha[l]=!h||g&&E>0?1:h?se:de),!M)continue;s.globalAlpha=c||h?se:g?de:1,Lt(se,_);const ue=c?Oe:o?He(se):se*Oe|0;if(ce==Ze){const P=_?0:(this._normalizedB(xe[ee[1].binLo])*Oe+ue)/2;if(S){if(_==0&&(A&&s.moveTo(...ye(0,0)),s.lineTo(...ye(0,w<0?P:ue))),w>=0){const be=[w,ue];s.lineTo(...ye(...be)),Je.push(be)}}else{if(_==0)if(O==-1&&!A)s.moveTo(R,ae-(w<R?P:ue));else{const be=Ee?this._normalizedB(xe[Ee-1])*Oe:ue;s.moveTo(R-E,ae-be)}(A||O!=-1||w>=R)&&s.lineTo(w,ae-ue)}}else if(o){if(pe&&!Y&&(l==0||!x)){const P=s.globalAlpha;s.strokeStyle=cs,s.globalAlpha=1,pt(q,T,ae),s.strokeStyle=s.fillStyle,s.globalAlpha=P}if(Ae){const P=c?0:Fe.findLastIndex(Xe=>He(se)<=He(Xe.level));let be=ae;for(let Xe=Ce-1;Xe>=P;Xe--){s.strokeStyle=Fe[Xe].color;let Dt=ae-(Xe==P?ue:He(Fe[Xe].level));pt(q,be,Dt),be=Dt-Ke}}else pt(q,ae,ae-ue)}else if(w>=R)if(S)bt(w,0,J,ue,g);else if(v){const P=J/2,be=ae+P;s.beginPath(),s.moveTo(w,be),s.lineTo(w,be-ue),s.arc(q,be-ue,P,Mt,Ye),s.lineTo(w+J,be),mt(g),s.fill()}else{const P=g?s.lineWidth:0;s.beginPath(),s.rect(w,ae+P,J,-ue-P),mt(g),s.fill()}const Ue=f.peak[l],Nt=f.alpha[l];if(Ue>0&&Nt>0&&I&&!Qe&&!c&&w>=R&&w<gt){if(he?s.globalAlpha=Nt:g&&E>0?s.globalAlpha=1:h&&(s.globalAlpha=Ue),(Q==Vt||Ae)&&Lt(Ue),o){const P=He(Ue);P>=Ke&&s.fillRect(w,ae-P,J,vt)}else if(!S)s.fillRect(w,ae-Ue*Oe,J,2);else if(ce!=Ze){const P=Ue*Oe;bt(w,P,J,!this._radialInvert||fe||P+B>=2?-2:2)}}}if(M){if(s.globalAlpha=1,ce==Ze){if(Lt(),S&&!A){if(O){let _;for(;_=Je.pop();)s.lineTo(...ye(..._,-1))}s.closePath()}if(E>0&&s.stroke(),de>0){if(S){const _=A?qe(we>>1):0,f=A?qe(we):Ye;s.moveTo(...ye(A?we>>1:0,0)),s.arc(V,N,B,_,f,A?!ze:!0)}else s.lineTo(gt,ae),s.lineTo(R,ae);s.globalAlpha=de,s.fill(),s.globalAlpha=1}if((Qe||S&&I)&&(Je=[],s.beginPath(),ee.forEach((_,f)=>{let w=_.posX,q=_.peak[l],J=f?"lineTo":"moveTo";if(S&&w<0){const ge=ee[f+1];q=Rs(w,q,ge.posX,ge.peak[l],0),w=0}q*=Oe,Qe?(s[J](...S?ye(w,q):[w,ae-q]),S&&O&&!A&&Je.push([w,q])):q>0&&bt(w,q,1,-2)}),Qe)){let _;for(;_=Je.pop();)s.lineTo(...ye(..._,-1));s.lineWidth=1,s.stroke()}}s.restore(),A&&!S&&s.setTransform(1,0,0,1,0,0),(!A&&!x||l)&&xi(l)}}if(Ei(It/(Ot<<Ft-1)),M&&(O&&!S&&!A&&(s.setTransform(-1,0,0,1,b.width-R,0),s.drawImage(b,R,0,V,b.height,0,0,V,b.height),s.setTransform(1,0,0,1,0,0)),s.setLineDash([]),Ai()),this.showFPS){const l=C.height;s.font=`bold ${l}px ${ht}`,s.fillStyle=hs,s.textAlign="right",s.fillText(Math.round(D),b.width-l,l*2)}this.onCanvasDraw&&(s.save(),s.fillStyle=s.strokeStyle=te[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:te}),s.restore())}_freqScaling(e){switch(this._frequencyScale){case je:return Math.log2(e);case Et:return 26.81*e/(1960+e)-.53;case St:return Math.log2(1+e/700);case et:return e}}_freqToBin(e,t="round"){const i=this._analyzer[0].frequencyBinCount-1,a=Math[t](e*this.fftSize/this.audioCtx.sampleRate);return a<i?a:i}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:t,_radial:i,_reflexRatio:a}=this,{analyzerWidth:h,centerX:n,centerY:o,initialX:c,innerRadius:y,outerRadius:g}=this._aux,{isLumi:v}=this._flg,p=this._chLayout==Se,k=1-a,V=v?e.height:e.height*(1-a*!p)|0;for(const N of[0,1]){const j=this._gradients[this._selectedGrads[N]],H=j.colorStops,le=j.dir=="h";let R;if(i?R=t.createRadialGradient(n,o,g,n,o,y-(g-y)*p):R=t.createLinearGradient(...le?[c,0,c+h,0]:[0,0,0,V]),H){const B=p&&!this._splitGradient&&(!le||i);for(let _e=0;_e<1+B;_e++){const ee=H.length-1;H.forEach((b,te)=>{let X=b.pos;if(B&&(X/=2),p&&!v&&!i&&!le&&(X*=k,!B&&X>.5*k&&(X+=.5*a)),_e==1)if(i||v){const Q=ee-te;b=H[Q],X=1-b.pos/2}else te==0&&X>0&&R.addColorStop(.5,b.color),X+=.5;R.addColorStop(X,b.color),p&&te==ee&&X<.5&&R.addColorStop(.5,b.color)})}}this._canvasGradients[N]=R}}_normalizedB(e){const t=this._linearAmplitude,i=t?1/this._linearBoost:1,a=(c,y,g)=>c<=y?y:c>=g?g:c,h=c=>10**(c/20);let n=this.maxDecibels,o=this.minDecibels;return t&&(n=h(n),o=h(o),e=h(e)**i),a((e-o)/(n-o)**i,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:t,_ctx:i}=this,a=this._scaleX.canvas,h=window.devicePixelRatio/(this._loRes+1);let n=window.screen.width*h,o=window.screen.height*h;Math.abs(window.orientation)==90&&n<o&&([n,o]=[o,n]);const c=this.isFullscreen,y=c&&this._fsEl==t,g=y?n:(this._width||this._container.clientWidth||this._defaultWidth)*h|0,v=y?o:(this._height||this._container.clientHeight||this._defaultHeight)*h|0;this._pixelRatio=h,this._fsWidth=n,this._fsHeight=o,!(e!=Jt&&t.width==g&&t.height==v)&&(t.width=g,t.height=v,this.overlay||(i.fillStyle="#000",i.fillRect(0,0,g,v)),i.lineJoin="bevel",a.width=g,a.height=Math.max(20*h,Math.min(g,v)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==c&&(e=ei),this._fsStatus=c,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,t){if(!this._gradients.hasOwnProperty(e))throw new Le(ms,e);[0,1].includes(t)||(this._selectedGrads[1]=e,t=0),this._selectedGrads[t]=e,this._makeGrad()}_setProps(e,t){const i=["onCanvasDraw","onCanvasResize"],a=["gradientLeft","gradientRight","stereo"],h=Object.keys(tt).filter(n=>n!="start").concat(i,a);(t||e===void 0)&&(e={...tt,...e});for(const n of Object.keys(e))i.includes(n)&&typeof e[n]!="function"?this[n]=void 0:h.includes(n)&&(this[n]=e[n]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const _t=Bt(!1),ft=Bt(),Ss=Bt([{audio:"",name:"Cant See"}]),ri=r=>{if(isNaN(r))return"0:00";const e=Math.floor(r/60);return r=Math.floor(r%60),r<10&&(r=`0${r}`),`${e}:${r}`};var Cs=$e('<div><img class="visualizer__logo svelte-1xq3dhw" alt="music visualizer logo" src="/images/brand-logo.svg"></div>');function ks(r,e){ci(e,!0);const[t,i]=gi(),a=()=>it(ft,"$audioPlayerEl",t),h=()=>it(_t,"$isPlaying",t);let n,o=ke(void 0),c=Si(()=>90+z(o)*150),y;function g(N){re(o,N.getEnergy(),!0)}function v(){ft&&!y&&(y=new Es(n,{barSpace:0,colorMode:"gradient",gradient:"rainbow",ledBars:!0,mirror:1,mode:4,onCanvasDraw:g,overlay:!0,roundBars:!0,showBgColor:!1,showPeaks:!1,showScaleX:!1,source:a()}))}pi(()=>()=>{y&&y.destroy()}),di(()=>{h()&&v()});var p=Cs();let k;var V=Z(p);U(p),dt(p,N=>n=N,()=>n),ve(N=>{k=vi(p,1,"visualizer svelte-1xq3dhw",null,k,N),Ii(V,`--energyHeight:${z(c)??""}px;`)},[()=>({"visualizer--playing":h()})]),oe(r,p),ui(),i()}function oi(r,e,t){re(e,!z(e)),z(e)===!0?re(t,0):re(t,.4)}function Ts(r,e,t){kt(_t,!1),t().pause()}function Bs(r,e,t,i){z(e)==0?re(e,t().length-1):re(e,(z(e)-1)%t().length),i()}function Ms(r,e,t,i){re(e,z(t)*(z(i).value/100))}function Is(r,e,t){re(e,z(t).value/100)}var Os=$e('<div class="info__name text-xl svelte-1nkxosh"> </div>'),Fs=$e('<button class="mp-btn play-btn svelte-1nkxosh" type="button"><!></button>'),Ns=$e('<button class="mp-btn play-btn svelte-1nkxosh" type="button"><!></button>'),Ds=$e('<button type="button"><div class="song-name text-small svelte-1nkxosh"> </div> <a class="download svelte-1nkxosh"><!></a></button>'),$s=$e('<!> <audio autoplay="false" crossorigin="anonymous"></audio> <div class="player svelte-1nkxosh"><div class="player__current svelte-1nkxosh"><div class="info svelte-1nkxosh"><!> <div class="info__time svelte-1nkxosh"><div class="info__current text-base svelte-1nkxosh"> </div> <input class="seekBar__control svelte-1nkxosh" list="marker" max="100" min="0" step="any" type="range"> <div class="info__duration text-base svelte-1nkxosh"> </div></div></div> <div class="player__btns svelte-1nkxosh"><div class="controls svelte-1nkxosh"><button class="mp-btn other-btn svelte-1nkxosh" type="button"><!></button> <!> <button class="mp-btn other-btn svelte-1nkxosh" type="button"><!></button></div> <div class="player__volume svelte-1nkxosh"><button class="mute__btn svelte-1nkxosh" type="button"><!></button> <input id="volume-control" max="100" min="0" step="any" type="range"></div></div></div> <div class="player__list svelte-1nkxosh"></div></div>',1);function Hs(r,e){ci(e,!0);const[t,i]=gi(),a=()=>it(_t,"$isPlaying",t),h=()=>it(ft,"$audioPlayerEl",t),n=()=>it(Ss,"$musicList",t);let o=ke(0),c=ke(void 0),y=ke(void 0),g=ke(.4),v=ke(void 0),p=ke(void 0),k=ke(void 0);function V(){kt(_t,!0);let d=h().play();d!==void 0&&d.then(u=>{video.pause()}).catch(u=>{console.log(u)})}function N(){re(o,(z(o)+1)%n().length),V()}function j(d){re(o,d,!0),V()}pi(()=>{h().pause()});let H=ke(void 0);di(()=>{re(H,z(y)/z(c)*100)});var le=$s(),R=_i(le);ks(R,{});var B=ne(R,2);dt(B,d=>kt(ft,d),()=>h());var _e=ne(B,2),ee=Z(_e),b=Z(ee),te=Z(b);{var X=d=>{var u=Os(),x=Z(u,!0);U(u),ve(()=>rt(x,n()[z(o)].name)),Fi(3,u,()=>Ni),oe(d,u)};xt(te,d=>{a()&&d(X)})}var Q=ne(te,2),s=Z(Q),ie=Z(s,!0);U(s);var he=ne(s,2);Gt(he),he.__input=[Ms,y,c,p],dt(he,d=>re(p,d),()=>z(p));var de=ne(he,2),D=Z(de,!0);U(de),U(Q),U(b);var F=ne(b,2),E=Z(F),m=Z(E);m.__click=[Bs,o,n,V];var W=Z(m);Ji(W,{color:"var(--color-text-quaternary)",height:"24",width:"24"}),U(m);var O=ne(m,2);{var ce=d=>{var u=Fs();u.__click=[Ts,a,h];var x=Z(u);Zi(x,{color:"var(--color-black)",height:"24",width:"24"}),U(u),oe(d,u)},Y=d=>{var u=Ns();u.__click=V;var x=Z(u);Qi(x,{color:"var(--color-black)",height:"24",width:"24"}),U(u),oe(d,u)};xt(O,d=>{a()?d(ce):d(Y,!1)})}var S=ne(O,2);S.__click=N;var pe=Z(S);ts(pe,{color:"var(--color-text-quaternary)",height:"24",width:"24"}),U(S),U(E);var I=ne(E,2),M=Z(I);M.__click=[oi,k,g],M.__keydown=[oi,k,g];var L=Z(M);{var C=d=>{ns(d,{color:"var(--color-text-quaternary)",height:"24",width:"24"})},G=d=>{ss(d,{color:"var(--color-text)",height:"24",width:"24"})};xt(L,d=>{z(k)?d(C):d(G,!1)})}U(M);var K=ne(M,2);Gt(K),K.__input=[Is,g,v],dt(K,d=>re(v,d),()=>z(v)),U(I),U(F),U(ee);var $=ne(ee,2);Bi($,5,n,Mi,(d,u,x)=>{var A=Ds();A.__click=()=>j(x);var fe=Z(A),me=Z(fe,!0);U(fe);var Ae=ne(fe,2),we=Z(Ae);qi(we,{color:"currentColor",height:"16",width:"16"}),U(Ae),U(A),ve(()=>{vi(A,1,Oi(x==z(o)?"cs song-active":"cs song"),"svelte-1nkxosh"),rt(me,z(u).name),Ve(Ae,"download",n()[x].audio),Ve(Ae,"href",n()[x].audio)}),oe(d,A)}),U($),U(_e),ve((d,u)=>{Ve(B,"src",n()[z(o)].audio),rt(ie,d),Ht(he,z(H)),rt(D,u),Ht(K,z(g)*100)},[()=>ri(z(y)),()=>ri(z(c))]),ki("ended",B,N),Gi(B,()=>z(k),d=>re(k,d)),$i(B,()=>z(y),d=>re(y,d)),Pi("duration","durationchange",B,d=>re(c,d)),Hi(B,()=>z(g),d=>re(g,d)),oe(r,le),ui(),i()}Ci(["input","click","keydown"]);var Gs=$e('<iframe scrolling="false" frameborder="0" allow="autoplay"></iframe>');function li(r,e){let t=ot(e,"soundcloudLink",8,""),i=ot(e,"width",8,"100%"),a=ot(e,"showVisual",8,!0),h=ot(e,"height",8,"300");Di(r,{get height(){return h()},get width(){return i()},children:(n,o)=>{var c=Gs();ve(()=>{Ve(c,"width",i()),Ve(c,"height",h()),Ve(c,"title",`soundcloud-${t()}`),Ve(c,"src",`https://w.soundcloud.com/player/?url=${t()??""}&visual=${a()??""}`)}),oe(n,c)},$$slots:{default:!0}})}var Ps=$e("<!> <section><!> <!></section> <section><!> <!> <!></section>",1);function ia(r){var e=Ps(),t=_i(e);Ti(t,{pageTitle:"Music"});var i=ne(t,2),a=Z(i);Pt(a,{sectionDesc:"Now you can listen and download Khoa's favorite songs. Live Radio included. Enjoy!",sectionTitle:"Music Player",children:(v,p)=>{Vi(v,$t(()=>p==null?void 0:p().sectionIcon))},$$slots:{default:!0}});var h=ne(a,2);Hs(h,{}),U(i);var n=ne(i,2),o=Z(n);Pt(o,{sectionTitle:"SoundCloud",children:(v,p)=>{Ui(v,$t(()=>p==null?void 0:p().sectionIcon))},$$slots:{default:!0}});var c=ne(o,2);li(c,{soundcloudLink:"https://soundcloud.com/falxce/falxce-berylxx-serenity?si=e37c4665ee3e4a87a5e76a302267f96f&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing"});var y=ne(c,2);li(y,{soundcloudLink:"https://soundcloud.com/falxce/osaka?si=476a413a993d433da0c6e7d8f388507e&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing"}),U(n),oe(r,e)}export{ia as component};
